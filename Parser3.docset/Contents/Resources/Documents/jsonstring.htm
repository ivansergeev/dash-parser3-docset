<html>
<head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=windows-1251">
    <meta name="keywords" content="">
    <title>string. Преобразование объекта Parser в JSON-строку</title>

</head>

<body bgcolor="#FFFFFF" text="black">


<table border="0" cellspacing="0" cellpadding="2">
  <tr>
    <td>
      
<span style="font-family:Arial; font-size:12pt; color:#000000"><b>string. Преобразование объекта Parser в JSON-строку
<br>
</b></span>
    </td>
  </tr>
  <tr><td bgcolor="#99D228" height="3"></td></tr>
</table>
<br>



<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^json:string[объект;опции преобразования]
<br>
</b><b>
<br>
</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Метод преобразует системный или пользовательский объект в JSON-строку.</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>

<br>
Опции</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>преобразования&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">- хеш, в котором можно указать:</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:Arial; font-size:10pt; color:#000000"><table border="0" cellpadding="1"><tr><td align="left" valign="top" width="288">
<span style="font-family:MS Sans Serif; font-size:8pt; color:#000000">
<br>
</span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b>По-умолчанию</b>
<br>
</span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b>Описание</b>
<br>
</span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.skip-unknown(</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=boolclass.htm>true|false</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>)</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">false
<br>
</span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">При указании значения <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>true</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> вместо exception в результирующую JSON-строку будут выдаваться значения 'null' при сериализации объектов с типами, отличными от <a href=voidclass.htm>void</a>, <a href=boolclass.htm>bool</a>, <a href=stringclass.htm>string</a>, <a href=intdoubleclasses.htm>int</a>, <a href=intdoubleclasses.htm>double</a>, <a href=dateclass.htm>date</a>, <a href=tableclass.htm>table</a>, <a href=hashclass.htm>hash</a> и <a href=fileclass.htm>file</a>.
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.indent(</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=boolclass.htm>true|false</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>)</b><b>
<br>
$.indent[</b><b>строка</b><b>]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">false
<br>
</span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">При указании значения <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>true</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет включено форматирование результирующей JSON-строки символами табуляции по глубине вложенности.
<br>
Можно указать строковое значение, которое будет использоваться как префикс при формировании строки с отступами.<b><i> [3.4.3]</i></b>
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.date[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">sql-string|gmt-string|unix-timestamp</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b>
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">sql-string<span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Опция определяет вид, в котором значения объектов класса <a href=dateclass.htm>date</a> будут попадать в результирующую JSON-строку (см. одноимённые методы объекта класса date).<span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.table[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">object|array|compact</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b>
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">object<span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Опция определяет вид, в котором значения объектов класса <a href=tableclass.htm>table</a> будут попадать в результирующую JSON-строку.
<br>
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>object</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">:
<br>
    [{"col1":"val11","col2":"val12",...},{"col1":"val21","col2":"val22",...},...]
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>array</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">:
<br>
    [["col1","col2",...] || null (для nameless таблиц),["val11","val12",...],...]
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>compact</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">:
<br>
     ["value11" || ["val11","val12",...],...]</span><span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.file[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">text|base64|stat</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b></span><span style="font-family:Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">не определён<span style="font-family:Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Опция определяет вид, в котором значения объектов типа <a href=fileclass.htm>file</a> будут попадать в результирующую JSON-строку.
<br>
По умолчанию (если данная опция не определена или её значение равно <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>stat</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">) в результирующую JSON-строку попадает информация об объектах класса file (имя файла, размер, content-type, mode), но их содержимое не попадает.</span><span style="font-family:Arial; font-size:10pt; color:#000000">
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.xdoc[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=xdocoptions.htm>параметры преобразования в текст</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b>
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">не определён<span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Опции преобразования объекта класса xdoc в строку&nbsp;&nbsp;&nbsp;<span style="font-family:Arial; font-size:10pt; color:#000000"><b><i>[3.4.2]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.класс[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=junctionclass.htm>ссылка на метод</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b></span><span style="font-family:Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">не определён<span style="font-family:Arial; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Любой класс (включая вышеупомянутые date, table и file) можно вывести используя пользовательский метод, который должен принимать 3 параметра: ключ, объект и опции вызова <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^json:string[]&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">(последнее нужно для рекурсивного вывода пользовательских объектов).
<br>
Поиск методов происходит во всех родительских классах.&nbsp;&nbsp;&nbsp;</span><span style="font-family:Arial; font-size:10pt; color:#000000"><b><i>[3.4.2]</i></b>
<br>
</span></span></td></tr><tr><td align="left" valign="top" width="288">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$._</b><b>default</b><b>[</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=junctionclass.htm>ссылка на метод</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b>
<br>
</span></span></td><td align="left" valign="top" width="103">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">не определён<span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td><td align="left" valign="top" width="467">
<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Если определён, то метод будет вызываться для всех объектов пользовательских классов (кроме тех, вывод которых явно задан с помощью опции <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.класс[</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><a href=junctionclass.htm>ссылка на метод</a></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">). Метод должен принимать 3 параметра: ключ, объект и опции вызова.&nbsp;&nbsp;&nbsp;</span><span style="font-family:Arial; font-size:10pt; color:#000000"><b><i>[3.4.2]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
</span></span></td></tr></table>
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Пример
<br>
</b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@main[]
<br>
$h[
<br>
&nbsp;&nbsp;&nbsp;$.void[]
<br>
&nbsp;&nbsp;&nbsp;$.bool(true)
<br>
&nbsp;&nbsp;&nbsp;$.double(1/2)
<br>
&nbsp;&nbsp;&nbsp;$.string[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>русские&nbsp;буквы</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
&nbsp;&nbsp;&nbsp;$.hash[
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.e[ee]
<br>
&nbsp;&nbsp;&nbsp;]
<br>
&nbsp;&nbsp;&nbsp;$.date[^date::create(2006;08;18;06;09;00)]
<br>
&nbsp;&nbsp;&nbsp;$.table[^table::create{c1&nbsp;&nbsp;&nbsp;c2&nbsp;&nbsp;&nbsp;c3^#0Av1&nbsp;&nbsp;&nbsp;v2&nbsp;&nbsp;&nbsp;v3^#0Av4&nbsp;&nbsp;&nbsp;v5&nbsp;&nbsp;&nbsp;v6}]
<br>
&nbsp;&nbsp;&nbsp;$.file[^file::create[text;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>zigi.txt</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>file-content</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]]
<br>
&nbsp;&nbsp;&nbsp;$.img[^image::create(100;100;0)]
<br>
]
<br>
^json:string[$h;
<br>
&nbsp;&nbsp;&nbsp;$.indent(true)
<br>
&nbsp;&nbsp;&nbsp;$.table[array]
<br>
&nbsp;&nbsp;&nbsp;$.file[base64]
<br>
&nbsp;&nbsp;&nbsp;$.image[$image_handler]
<br>
]
<br>

<br>
@image_handler[key;value</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>;params</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
"</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>custom&nbsp;value&nbsp;of&nbsp;image&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$key"</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>

<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">В результате выполнения будет выведено:</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>{
<br>
&nbsp;&nbsp;&nbsp;"void":"",
<br>
&nbsp;&nbsp;&nbsp;"bool":true,
<br>
&nbsp;&nbsp;&nbsp;"double":0.5,
<br>
&nbsp;&nbsp;&nbsp;"string":"русские&nbsp;буквы",
<br>
&nbsp;&nbsp;&nbsp;"hash":{
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"e":"ee"
<br>
&nbsp;&nbsp;&nbsp;},
<br>
&nbsp;&nbsp;&nbsp;"date":"2006-08-18&nbsp;06:09:00",
<br>
&nbsp;&nbsp;&nbsp;"table":[
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["c1","c2","c3"],
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["v1","v2","v3"],
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["v4","v5","v6"]
<br>
&nbsp;&nbsp;&nbsp;],
<br>
&nbsp;&nbsp;&nbsp;"file":{
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"class":"file",
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name":"zigi.txt",
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"size":12,
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"content-type":"text\/plain",
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"mode":"text",
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"base64":"ZmlsZS1jb250ZW50"
<br>
&nbsp;&nbsp;&nbsp;},
<br>
&nbsp;&nbsp;&nbsp;"img":"custom&nbsp;value&nbsp;of&nbsp;image&nbsp;img"
<br>
}
<br>
</b></span></span><br>


<hr size=1>
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<tr valign="top">
<td><font size="1">Copyright &copy; 1997&#150;2013 Art. Lebedev Studio | <a href="http://www.artlebedev.ru/" target="_blank">http://www.artlebedev.ru</a></font></td>
<td align="right"><font size="1">Дата обновления: 22.10.2013</font></td>
</tr>
</table>
</body>
</html>
